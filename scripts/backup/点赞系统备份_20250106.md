# 点赞系统备份 - 2025-01-06

## 备份说明
重构点赞系统前的完整备份，包含所有现有的点赞相关API文件和逻辑。

## 备份文件列表

### 1. toggle_like.php - 点赞切换接口
- 功能：统一的点赞/取消点赞切换接口
- 特点：基于IP地址识别用户，支持BIGINT类型wallpaper_id
- 备份时间：2025-01-06

### 2. like_wallpaper.php - 点赞接口
- 功能：添加点赞记录
- 特点：支持登录用户（user_id）和未登录用户（IP）双重识别
- 备份时间：2025-01-06

### 3. unlike_wallpaper.php - 取消点赞接口
- 功能：删除点赞记录
- 特点：支持登录用户和未登录用户的点赞记录删除
- 备份时间：2025-01-06

### 4. check_like.php - 检查点赞状态接口
- 功能：检查用户是否已点赞某个壁纸
- 特点：根据登录状态使用不同的查询逻辑
- 备份时间：2025-01-06

### 5. get_like_count.php - 获取点赞数接口
- 功能：获取指定壁纸的总点赞数
- 特点：简单的COUNT查询
- 备份时间：2025-01-06

### 6. my_likes.php - 获取用户点赞列表接口
- 功能：获取当前用户点赞的所有壁纸ID
- 特点：支持登录用户和未登录用户的点赞记录查询
- 备份时间：2025-01-06

## 现有逻辑特点

### 用户识别机制
1. **登录用户**：优先使用user_id，同时记录ip_address
2. **未登录用户**：仅使用ip_address，user_id为NULL
3. **登录时处理**：删除IP记录，插入用户ID记录

### 数据表结构
- **wallpaper_likes表**：存储点赞记录
  - wallpaper_id: 壁纸ID（支持BIGINT）
  - user_id: 用户ID（可为NULL）
  - ip_address: IP地址
  - created_at: 创建时间

- **wallpapers表**：壁纸主表
  - likes字段：点赞总数（部分接口会更新此字段）

### 存在的问题
1. **数据冗余**：wallpapers.likes字段与wallpaper_likes表记录数可能不一致
2. **性能问题**：实时COUNT查询在大数据量时性能较差
3. **同步复杂**：登录时需要复杂的数据迁移逻辑
4. **数据分离**：登录前后的点赞数据查询逻辑不统一

## 恢复说明
如果重构过程中出现问题，可以：
1. 停用新的API接口
2. 恢复使用备份的原始文件
3. 检查数据库表结构是否需要回滚
4. 验证功能正常后再进行下一步操作

## 重构目标
1. 保持wallpapers主表字段不变
2. 优化性能，支持大量点赞数据
3. 统一用户识别机制
4. 简化代码逻辑，提高可维护性